============================================================
Key-Value Store - Full Test Suite
============================================================
KVStore server listening on localhost:8010

==================================================
RUNNING BASIC FUNCTIONAL TESTS (Direct Server)
==================================================

1. Test: Set then Get
   âœ“ PASSED

2. Test: Set then Delete then Get
   âœ“ PASSED

3. Test: Persistence (Restart)
Saving indexes...
Loaded indexes from kvstore_test\node_0\indexes.json
KVStore server listening on localhost:8010
   âœ“ PASSED
Saving indexes...

==================================================
ACID TEST 1: Concurrent Bulk Write Isolation
==================================================
   Starting concurrent conflicting transactions...
   âœ“ SUCCESS: Transaction Isolation confirmed. All keys are 'B'.

==================================================
ACID TEST 2: Atomicity (SIGKILL Crash)
==================================================
   Initiating massive bulk write...
   ğŸ’€ KILLING SERVER with SIGKILL...
   Restarting server to verify WAL Atomicity...
   âœ“ SUCCESS: Atomicity Preserved (Committed).

==================================================
ACID TEST 3: Chaos Snapshot (Bonus)
==================================================
   Attempting Snapshot with simulated disk failure...
   Snapshot outcome: True
Rebuilding indexes for 1 keys...
   âœ“ SUCCESS: Data recovered from WAL despite snapshot failure.

======================================================================
RAFT REPLICATION TESTS (cluster.py)
======================================================================

â³ Waiting for Raft cluster to elect a leader...
  âœ“ Leader elected: Node 0 (port 8100)

ğŸ“ Test 1: Write to leader
  âœ“ PASSED â€” write accepted by leader

ğŸ“– Test 2: Read from follower
  âœ“ PASSED â€” data confirmed on leader after replication

ğŸ’€ Test 3: Kill leader, wait for failover
  Killed Node 0, waiting for new election...
  âœ“ PASSED â€” new leader: Node 1

ğŸ“ Test 4: Write after failover
  âœ“ PASSED â€” write accepted by new leader

âš¡ Test 5: Concurrent writes to leader
  âœ“ PASSED â€” 100 concurrent writes succeeded

======================================================================
MASTERLESS REPLICATION TESTS (masterless.py)
======================================================================

â³ Waiting for Masterless cluster to start...
  âœ“ All 3 nodes are up

ğŸ“ Test 1: Write to Node 0 (any node accepts writes)
  âœ“ PASSED â€” Node 0 accepted write

ğŸ“– Test 2: Read from Node 2 (replicated?)
  âœ“ PASSED â€” data replicated to Node 2

ğŸ’€ Test 3: Kill Node 1, check other nodes still work
  Killed Node 1...
  âœ“ PASSED â€” Node 0 still accepts writes with Node 1 down

ğŸ“– Test 4: Read 'after_kill' from Node 2
  âœ“ PASSED â€” data replicated to Node 2 (skipping dead Node 1)

âš¡ Test 5: Concurrent writes to Node 0 AND Node 2
  âŒ FAILED â€” errors: 0, cross-read ok: False

======================================================================
REPLICATION COMPARISON: RAFT vs MASTERLESS
======================================================================
Test                           |      Raft       |   Masterless   
----------------------------------------------------------------------
Write accepted                 |    âœ… PASSED     |    âœ… PASSED    
Read after replication         |    âœ… PASSED     |    âœ… PASSED    
Node failure tolerance         |    âœ… PASSED     |    âœ… PASSED    
Write after node fail          |    âœ… PASSED     |    âœ… PASSED    
Concurrent multi-node          |    âœ… PASSED     |    âŒ FAILED    
----------------------------------------------------------------------
TOTAL                          |       5/5       |       4/5      
======================================================================

ğŸ“– HOW THEY DIFFER:
----------------------------------------------------------------------
  RAFT (cluster.py):
    â€¢ One LEADER accepts all writes
    â€¢ Followers are read-only replicas
    â€¢ Leader failure â†’ automatic election (5-6 sec)
    â€¢ Strong consistency â€” all reads see latest write

  MASTERLESS (masterless.py):
    â€¢ ALL nodes accept reads AND writes
    â€¢ No election needed â€” no single point of failure
    â€¢ Conflicts resolved with vector clocks (LWW)
    â€¢ Eventual consistency â€” replication is async (50ms)
======================================================================
======================================================================
ENHANCED KV STORE - COMPREHENSIVE TEST SUITE
======================================================================

======================================================================
TEST 1: Full-Text Search (Inverted Index)
======================================================================
KVStore server listening on localhost:9201

ğŸ“ Inserting documents...
   Inserted 5 documents

ğŸ” Test 1a: OR search for 'Python programming'
   Found keys: ['doc1', 'doc4', 'doc3']
   âœ“ PASSED

ğŸ” Test 1b: Search for 'JavaScript'
   Found keys: ['doc2']
   âœ“ PASSED

ğŸ” Test 1c: Search for 'Rust' (not in any doc)
   Found keys: []
   âœ“ PASSED

âœ… Full-Text Search â€” ALL PASSED
Saving indexes...

======================================================================
TEST 2: Semantic Search (Word Embeddings)
======================================================================
KVStore server listening on localhost:9202

ğŸ“ Inserting documents...

ğŸ§  Test 2a: Semantic search for 'coding languages'
   Results (key, score): [['doc4', 0.4481], ['doc1', 0.4382], ['doc3', 0.1222]]
   âœ“ PASSED (sorted by similarity)

ğŸ§  Test 2b: Semantic search top_k=1
   Results: [['doc4', 0.6037]]
   âœ“ PASSED

âœ… Semantic Search â€” ALL PASSED
Saving indexes...

======================================================================
TEST 3: Index Persistence
======================================================================

ğŸ“ Phase 1: Creating indexes...
KVStore server listening on localhost:9203
   Saved indexes to disk
Saving indexes...

ğŸ”„ Phase 2: Restarting server...
Loaded indexes from test_persist_9203\node_0\indexes.json
KVStore server listening on localhost:9203
   Searching for 'fox' after restart...
   Found keys: ['key1']
   âœ“ PASSED â€” indexes survived restart

âœ… Index Persistence â€” PASSED
Saving indexes...

======================================================================
TEST 4: Phrase Search (Exact Match)
======================================================================
KVStore server listening on localhost:9204

ğŸ” Test 4a: Phrase search 'lazy dog'
   Found keys: ['s1', 's2']
   âœ“ PASSED

ğŸ” Test 4b: Phrase search 'blue cat'
   Found keys: []
   âœ“ PASSED

âœ… Phrase Search â€” ALL PASSED
Saving indexes...

======================================================================
TEST 5: Concurrent Indexing
======================================================================
KVStore server listening on localhost:9205

ğŸ“ Starting 5 concurrent writers (100 writes each)...
   Completed 500 writes with 0 errors

ğŸ” Verifying data and search after concurrent writes...
   Full-text search 'Python' found 10 results
   âœ“ PASSED â€” all threads wrote successfully, search works

âœ… Concurrent Indexing â€” PASSED
Saving indexes...

======================================================================
TEST 6: Delete Updates Index
======================================================================
KVStore server listening on localhost:9206
   âœ“ Key found before delete
   âœ“ Key removed from index after delete

âœ… Delete Updates Index â€” PASSED
Saving indexes...

======================================================================
TEST SUMMARY
======================================================================
  âœ… Passed: 6/6
  âŒ Failed: 0/6
======================================================================

======================================================================
BENCHMARK: Write Throughput
======================================================================
KVStore server listening on localhost:8002
Benchmarking 10,000 INDIVIDUAL writes... Done!
Saving indexes...
KVStore server listening on localhost:8002
Pre-populating with 1,000 keys... Done!
Benchmarking 10,000 INDIVIDUAL writes... Done!
Saving indexes...
KVStore server listening on localhost:8002
Pre-populating with 10,000 keys... Done!
Benchmarking 10,000 INDIVIDUAL writes... Done!
Saving indexes...
KVStore server listening on localhost:8002
Pre-populating with 50,000 keys... Done!
Benchmarking 10,000 INDIVIDUAL writes... Done!
Saving indexes...

======================================================================
WRITE THROUGHPUT RESULTS (Individual Set() Operations)
======================================================================
  Existing Keys |    Elapsed Time |           Throughput
----------------------------------------------------------------------
              0 |           6.06s |   1650.24 writes/sec
          1,000 |           6.08s |   1644.88 writes/sec
         10,000 |           6.12s |   1634.77 writes/sec
         50,000 |           6.08s |   1643.80 writes/sec
======================================================================

ğŸ“ˆ PERFORMANCE ANALYSIS:
  â€¢ Average Throughput: 1,643.42 writes/sec
  â€¢ Best Performance: 1,650.24 writes/sec
  â€¢ Worst Performance: 1,634.77 writes/sec
  â€¢ Performance Degradation: 0.4% (0 keys â†’ 50k keys)

  ğŸ’¡ Note: Each Set() operation includes:
     - TCP round-trip to server
     - Write to WAL file
     - fsync() to physical disk
     - Response back to client

  âš¡ For batch operations, use BulkSet() for 10-50x better throughput
======================================================================

======================================================================
BENCHMARK: Durability (Random Crash Testing)
======================================================================
Starting durability test server...
âœ“ Server connection verified

The server will be FORCEFULLY KILLED and restarted 5 times randomly.

âœ“ Writer thread connected successfully
  ğŸ’€ Crash #1/5: KILLING server process (had 98 writes)...
  ğŸ”„ Crash #1/5: Restarting server...
  ğŸ’€ Crash #2/5: KILLING server process (had 556 writes)...
  ğŸ”„ Crash #2/5: Restarting server...
  ğŸ’€ Crash #3/5: KILLING server process (had 1,006 writes)...
  ğŸ”„ Crash #3/5: Restarting server...
  ğŸ’€ Crash #4/5: KILLING server process (had 1,484 writes)...
  ğŸ”„ Crash #4/5: Restarting server...
  ğŸ’€ Crash #5/5: KILLING server process (had 1,944 writes)...
  ğŸ”„ Crash #5/5: Restarting server...

  ğŸ” Final check: Restarting server to verify data...
  Verifying 2,279 acknowledged writes...

======================================================================
DURABILITY TEST RESULTS
======================================================================
Metric                                   |                     Value
----------------------------------------------------------------------
Number of server crashes                 |                         5
Total acknowledged writes                |                     2,279
Lost keys after recovery                 |                         0
Recovered keys                           |                     2,279
Data durability                          |                   100.00%
======================================================================
âœ“ SUCCESS: 100% durability achieved!
  All acknowledged writes survived FORCEFUL KILLS.
======================================================================

============================================================
All tests and benchmarks completed!
Results saved to result.txt
============================================================
